# C:/Anirudh/solo-level/sololeveling.kv

# --- Custom Widget Definitions ---

<DraggableTaskItem>:
    # This is the viewclass for our RecycleView.
    # It defines the layout for a single task item.
    drag_rectangle: self.x, self.y, self.width, self.height
    drag_timeout: 10000000
    drag_distance: 0
    size_hint_y: None
    height: '48dp'
    padding: '8dp'
    spacing: '8dp'

    CheckBox:
        size_hint_x: None
        width: '48dp'
        active: root.completed
        on_active: root.dispatch('on_toggle_complete', self.active)

    Label:
        text: f"{root.title} ({root.points} pts)"
        halign: 'left'
        valign: 'middle'
        text_size: self.size

    Button:
        text: 'X'
        size_hint_x: None
        width: '48dp'
        on_press: root.dispatch('on_delete_task')

<TaskList>:
    # This is our custom RecycleView.
    viewclass: 'DraggableTaskItem'
    key_viewclass: 'viewclass'
    key_size: 'height'

    RecycleBoxLayout:
        default_size: None, '48dp'
        default_size_hint: 1, None
        size_hint_y: None
        height: self.minimum_height
        orientation: 'vertical'
        spacing: '2dp'

# --- Root Widget Definition ---

<MainLayout>:
    orientation: 'vertical'

    # Top bar for scoreboard
    BoxLayout:
        size_hint_y: None
        height: '48dp'
        padding: '8dp'
        canvas.before:
            Color:
                rgba: 0.1, 0.1, 0.1, 1
            Rectangle:
                pos: self.pos
                size: self.size
        Label:
            id: scoreboard_label
            text: "Total Points: 0"
            font_size: '20sp'
            bold: True

    # Main content area with tabs
    TabbedPanel:
        id: main_tabs
        do_default_tab: False
        tab_pos: 'top_mid'
        on_current_tab: app.on_tab_switch(self.current_tab)

        TabbedPanelItem:
            text: 'Monday'
            TaskList:
                id: monday_task_list

        TabbedPanelItem:
            text: 'Tuesday'
            TaskList:
                id: tuesday_task_list

        TabbedPanelItem:
            text: 'Wednesday'
            TaskList:
                id: wednesday_task_list

        TabbedPanelItem:
            text: 'Thursday'
            TaskList:
                id: thursday_task_list

        TabbedPanelItem:
            text: 'Friday'
            TaskList:
                id: friday_task_list

        TabbedPanelItem:
            text: 'Saturday'
            TaskList:
                id: saturday_task_list

        TabbedPanelItem:
            text: 'Sunday'
            TaskList:
                id: sunday_task_list

        TabbedPanelItem:
            text: app.QUICK_NOTES_TAB_TEXT # Use the constant from Python
            TextInput:
                id: quick_notes_input
                hint_text: "Jot down your thoughts..."
                background_color: (0.15, 0.15, 0.15, 1)
                foreground_color: (0.9, 0.9, 0.9, 1)
                padding: '10dp'

    # Bottom bar for adding new tasks
    BoxLayout:
        id: add_task_bar
        size_hint_y: None
        height: '48dp'
        padding: '4dp'
        spacing: '4dp'

        TextInput:
            id: task_title_input
            hint_text: "Enter new task title..."
            multiline: False
            on_text_validate: app.add_task() # Add task on pressing Enter

        TextInput:
            id: task_points_input
            hint_text: "Pts"
            size_hint_x: None
            width: '60dp'
            input_filter: 'int'
            multiline: False
            on_text_validate: app.add_task() # Add task on pressing Enter

        Button:
            text: "Add Task"
            size_hint_x: None
            width: '100dp'
            on_press: app.add_task()
